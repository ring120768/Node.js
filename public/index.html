<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Car Crash Lawyer AI - Legal Support at the Scene</title>
    <link rel="icon" type="image/webp" href="/images/car-crash-lawyer-ai-450.webp">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #0B7AB0 0%, #1EA1D4 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            padding-top: 40px;
            position: relative;
        }

        .logo-section {
            text-align: center;
            margin-bottom: 20px;
            animation: fadeInDown 0.8s ease;
        }

        .logo-section img {
            width: 150px;
            height: auto;
            margin-bottom: 20px;
            
        }

        .logo-section h1 {
            color: white;
            font-size: 42px;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        .logo-section p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 18px;
            margin-bottom: 20px;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .button-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            width: 100%;
            max-width: 450px;
            animation: fadeInUp 1s ease;
            margin-top: 20px;
        }

        /* 3D EMERGENCY BUTTON - Apple Style */
        .emergency-btn {
            position: relative;
            padding: 24px 40px;
            background: linear-gradient(180deg, #ff3b30 0%, #d32f2f 100%);
            color: white;
            border: none;
            border-radius: 16px;
            font-size: 22px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 
                0 8px 16px rgba(255, 59, 48, 0.4),
                0 4px 8px rgba(0, 0, 0, 0.3),
                inset 0 2px 0 rgba(255, 255, 255, 0.3),
                inset 0 -2px 0 rgba(0, 0, 0, 0.3);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            transform: translateY(0);
        }

        .emergency-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 50%;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.2) 0%, transparent 100%);
            border-radius: 16px 16px 0 0;
        }

        .emergency-btn:hover {
            transform: translateY(-3px);
            box-shadow: 
                0 12px 24px rgba(255, 59, 48, 0.5),
                0 6px 12px rgba(0, 0, 0, 0.4),
                inset 0 2px 0 rgba(255, 255, 255, 0.4),
                inset 0 -2px 0 rgba(0, 0, 0, 0.3);
        }

        .emergency-btn:active {
            transform: translateY(2px);
            box-shadow: 
                0 4px 8px rgba(255, 59, 48, 0.3),
                0 2px 4px rgba(0, 0, 0, 0.2),
                inset 0 2px 4px rgba(0, 0, 0, 0.4);
        }

        .emergency-btn .btn-icon {
            font-size: 28px;
            margin-right: 10px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* Secondary Buttons */
        .secondary-btn {
            padding: 16px 32px;
            background: white;
            color: #0B7AB0;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .secondary-btn:hover {
            background: #0B7AB0;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(11, 122, 176, 0.4);
        }

        .secondary-btn .btn-icon {
            margin-right: 8px;
            font-size: 20px;
        }

        /* Divider */
        .divider {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 10px 0;
        }

        .divider::before,
        .divider::after {
            content: '';
            flex: 1;
            height: 2px;
            background: rgba(255, 255, 255, 0.3);
        }

        .divider span {
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Auth Buttons Container */
        .auth-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .auth-btn {
            padding: 14px 20px;
            border: 2px solid white;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .auth-btn.logout {
            background: transparent;
            color: white;
            display: none; /* Hidden by default, shown when logged in */
        }

        .auth-btn.logout:hover {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(255, 255, 255, 0.3);
        }

        .auth-btn.signup {
            background: white;
            color: #0B7AB0;
        }

        .auth-btn.signup:hover {
            background: #0B7AB0;
            color: white;
            border-color: #0B7AB0;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(11, 122, 176, 0.4);
        }

        /* Emergency Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(8px);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .modal-overlay.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .emergency-modal {
            background: white;
            border-radius: 24px;
            padding: 32px;
            max-width: 450px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: slideUp 0.4s ease;
            position: relative;
        }

        .modal-header {
            text-align: center;
            margin-bottom: 24px;
        }

        .modal-header h2 {
            color: #ff3b30;
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .modal-header p {
            color: #666;
            font-size: 14px;
        }

        .location-section {
            background: #f5f5f5;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .location-section h3 {
            color: #333;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .what3words-box {
            background: #0B7AB0;
            color: white;
            padding: 16px;
            border-radius: 8px;
            font-size: 20px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 12px;
            font-family: monospace;
            position: relative;
        }

        .what3words-box::before {
            content: '///';
            position: absolute;
            left: 16px;
            color: rgba(255, 255, 255, 0.7);
        }

        .address-box {
            background: white;
            padding: 12px;
            border-radius: 8px;
            font-size: 14px;
            color: #666;
            margin-bottom: 12px;
        }

        .copy-btn {
            width: 100%;
            padding: 12px;
            background: #f5f5f5;
            color: #0B7AB0;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .copy-btn:hover {
            background: #e0e0e0;
        }

        .copy-btn.copied {
            background: #27ae60;
            color: white;
            border-color: #27ae60;
        }

        .call-999-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(180deg, #ff3b30 0%, #d32f2f 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 20px;
            font-weight: 700;
            cursor: pointer;
            margin-bottom: 12px;
            box-shadow: 0 4px 12px rgba(255, 59, 48, 0.4);
            transition: all 0.2s ease;
        }

        .call-999-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(255, 59, 48, 0.5);
        }

        .cancel-btn {
            width: 100%;
            padding: 14px;
            background: transparent;
            color: #666;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .cancel-btn:hover {
            background: #f5f5f5;
        }

        .loading-spinner {
            text-align: center;
            padding: 20px;
            color: #0B7AB0;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #0B7AB0;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            background: #fee;
            color: #c33;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 12px;
            font-size: 14px;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 480px) {
            body {
                padding-top: 60px;
            }

            .logo-section h1 {
                font-size: 32px;
            }

            .emergency-btn {
                font-size: 20px;
                padding: 20px 32px;
            }

            .secondary-btn {
                font-size: 16px;
                padding: 14px 28px;
            }

            .emergency-modal {
                padding: 24px;
            }

            .auth-buttons {
                grid-template-columns: 1fr;
            }
        }
    .logo-section img, .site-branding{width:450px;max-width:100%;height:auto;margin-bottom:20px;}@media(max-width:520px){.logo-section img, .site-branding{width:320px;}}@media(max-width:380px){.logo-section img, .site-branding{width:260px;}}</style>
    <link rel="stylesheet" href="/css/mascot.css"></head>
<body>
    <!-- EMERGENCY BUTTON - TOP PRIORITY -->
    <button class="emergency-btn" id="emergencyBtn" style="margin-bottom: 30px; max-width: 450px; width: 100%;">
        <span class="btn-icon">üö®</span>
        Get Help Now - Call 999
    </button>

    <div class="logo-section">
        <img src="/images/car-crash-lawyer-ai-450.webp" alt="Car Crash Lawyer AI logo" class="site-branding" width="450" height="450" style="display:block;margin:0 auto 20px;max-width:100%;height:auto;image-rendering:crisp-edges;image-rendering:-webkit-optimize-contrast;">
        <h1>Car Crash Lawyer AI</h1>
        <p>Legal support at the scene ‚Äì fast, smart, AI-powered.</p>
        <p style="font-size: 16px; margin-top: 10px;">Get help. Record evidence. Protect your rights.</p>
    </div>

    <div class="button-container">
        <!-- REPORT INCIDENT BUTTON -->
        <button class="secondary-btn" id="incidentBtn">
            <span class="btn-icon">üìù</span>
            Report an Incident
        </button>

        <!-- DASHBOARD BUTTON -->
        <button class="secondary-btn" id="dashboardBtn">
            <span class="btn-icon">üìã</span>
            View My Reports
        </button>

        <!-- DEMO BUTTON -->
        <button class="secondary-btn" id="demoBtn">
            <span class="btn-icon">üé¨</span>
            Try Demo
        </button>

        <!-- USER GUIDE BUTTON -->
        <button class="secondary-btn" id="userGuideBtn">
            <span class="btn-icon">üìñ</span>
            User Guide
        </button>

        <!-- DIVIDER -->
        <div class="divider">
            <span>Account</span>
        </div>

        <!-- AUTH BUTTONS -->
        <div class="auth-buttons">
            <button class="auth-btn logout" id="logoutBtn">
                üö™ Logout
            </button>
            <button class="auth-btn signup" id="signupBtn">
                ‚ú® Sign Up
            </button>
        </div>
    </div>

    <!-- EMERGENCY MODAL -->
    <div class="modal-overlay" id="emergencyModal">
        <div class="emergency-modal">
            <div class="modal-header">
                <h2>üö® Emergency Assistance</h2>
                <p>Your location is ready to share with emergency services</p>
            </div>

            <div id="modalContent">
                <div class="loading-spinner">
                    <div class="spinner"></div>
                    <p>Getting your location...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- USER GUIDE MODAL -->
    <div class="modal-overlay" id="userGuideModal">
        <div class="emergency-modal">
            <div class="modal-header">
                <h2>üìñ User Guide</h2>
                <p>Choose the guide you need</p>
            </div>

            <div id="guideContent">
                <button class="secondary-btn" data-guide="signup" style="width: 100%; margin-bottom: 15px;">
                    <span class="btn-icon">‚ú®</span>
                    Signup Guide
                </button>

                <button class="secondary-btn" data-guide="incident" style="width: 100%; margin-bottom: 15px;">
                    <span class="btn-icon">üìù</span>
                    Incident Reports Guide
                </button>

                <button class="secondary-btn" data-guide="scenarios" style="width: 100%; margin-bottom: 20px;">
                    <span class="btn-icon">üé≠</span>
                    Example Scenarios
                </button>

                <button class="cancel-btn" data-action="cancel-guide">
                    Close
                </button>
            </div>
        </div>
    </div>

    <script>
        // Get references to elements
        const emergencyBtn = document.getElementById('emergencyBtn');
        const emergencyModal = document.getElementById('emergencyModal');
        const modalContent = document.getElementById('modalContent');

        let currentLocation = null;
        let what3wordsAddress = null;

        // Emergency button click handler
        emergencyBtn.addEventListener('click', async function() {
            emergencyModal.classList.add('show');
            await getLocationAndWhat3Words();
        });

        // Get location and convert to what3words
        async function getLocationAndWhat3Words() {
            try {
                // Request geolocation
                if (!navigator.geolocation) {
                    showError('Geolocation is not supported by your browser');
                    return;
                }

                navigator.geolocation.getCurrentPosition(
                    async (position) => {
                        currentLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };

                        // Get what3words address
                        await convertToWhat3Words(currentLocation.lat, currentLocation.lng);
                    },
                    (error) => {
                        console.error('Geolocation error:', error);
                        showError('Unable to get your location. Please enable location services.');
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 0
                    }
                );
            } catch (error) {
                console.error('Location error:', error);
                showError('Failed to get location. Please try again.');
            }
        }

        // Convert coordinates to what3words
        async function convertToWhat3Words(lat, lng) {
            try {
                const response = await fetch(`/api/location/convert?lat=${lat}&lng=${lng}`);
                const data = await response.json();

                if (response.ok && data.words) {
                    what3wordsAddress = data.words;
                    displayLocationInfo(data);
                } else {
                    showError('Unable to get what3words address');
                }
            } catch (error) {
                console.error('what3words error:', error);
                showError('Failed to convert location to what3words address');
            }
        }

        // Display location information
        function displayLocationInfo(data) {
            const regularAddress = data.nearestPlace || 'Address lookup in progress...';

            modalContent.innerHTML = `
                <div class="location-section">
                    <h3>üìç Your Location</h3>

                    <div class="what3words-box">
                        ${data.words}
                    </div>

                    <div class="address-box">
                        üìÆ ${regularAddress}<br>
                        üó∫Ô∏è ${currentLocation.lat.toFixed(6)}, ${currentLocation.lng.toFixed(6)}
                    </div>

                    <button class="copy-btn" data-action="copy">
                        üìã Copy Location to Clipboard
                    </button>
                </div>

                <button class="call-999-btn" data-action="call999">
                    üìû Call 999 Now
                </button>

                <button class="cancel-btn" data-action="cancel">
                    Cancel
                </button>
            `;
        }

        // Show error in modal
        function showError(message) {
            modalContent.innerHTML = `
                <div class="error-message">
                    ‚ö†Ô∏è ${message}
                </div>
                <button class="call-999-btn" data-action="call999">
                    üìû Call 999 Anyway
                </button>
                <button class="cancel-btn" data-action="cancel">
                    Cancel
                </button>
            `;
        }

        // Copy location to clipboard
        function copyLocation() {
            const locationText = what3wordsAddress 
                ? `Location: ///${what3wordsAddress}\nCoordinates: ${currentLocation.lat}, ${currentLocation.lng}`
                : `Location: ${currentLocation.lat}, ${currentLocation.lng}`;

            navigator.clipboard.writeText(locationText).then(() => {
                const btn = document.querySelector('.copy-btn');
                btn.textContent = '‚úì Copied to Clipboard!';
                btn.classList.add('copied');

                setTimeout(() => {
                    btn.textContent = 'üìã Copy Location to Clipboard';
                    btn.classList.remove('copied');
                }, 3000);
            });
        }

        // Call 999 emergency
        function call999() {
            // For mobile devices, this will trigger the phone dialer
            window.location.href = 'tel:999';
        }

        // Close modal
        function closeModal() {
            emergencyModal.classList.remove('show');
        }

        // Close modal when clicking outside
        emergencyModal.addEventListener('click', function(e) {
            if (e.target === emergencyModal) {
                closeModal();
            }
        });

        // Event delegation for modal buttons (handles dynamically added buttons)
        emergencyModal.addEventListener('click', function(e) {
            const button = e.target.closest('[data-action]');
            if (!button) return;

            const action = button.getAttribute('data-action');

            switch(action) {
                case 'call999':
                    call999();
                    break;
                case 'cancel':
                    closeModal();
                    break;
                case 'copy':
                    copyLocation();
                    break;
            }
        });

        // Navigate to incident report (seamless - server handles auth)
        function navigateToIncident() {
            console.log('üìù Incident button clicked - navigating to incident page');
            window.location.href = '/incident.html';
        }

        // Navigate to dashboard (seamless - server handles auth)
        function navigateToDashboard() {
            console.log('üìã Dashboard button clicked - navigating to dashboard');
            console.log('üç™ Current cookies:', document.cookie);
            console.log('üîó Navigating to: /dashboard.html');
            console.log('üìç Current location:', window.location.href);
            window.location.href = '/dashboard.html';
        }

        // User Guide Modal Functions
        function showGuideMenu() {
            const userGuideModal = document.getElementById('userGuideModal');
            const guideContent = document.getElementById('guideContent');

            guideContent.innerHTML = `
                <button class="secondary-btn" data-guide="signup" style="width: 100%; margin-bottom: 15px;">
                    <span class="btn-icon">‚ú®</span>
                    Signup Guide
                </button>

                <button class="secondary-btn" data-guide="incident" style="width: 100%; margin-bottom: 15px;">
                    <span class="btn-icon">üìù</span>
                    Incident Reports Guide
                </button>

                <button class="secondary-btn" data-guide="scenarios" style="width: 100%; margin-bottom: 20px;">
                    <span class="btn-icon">üé≠</span>
                    Example Scenarios
                </button>

                <button class="cancel-btn" data-action="cancel-guide">
                    Close
                </button>
            `;
        }

        function showGuideContent(type) {
            const guideContent = document.getElementById('guideContent');

            let content = '';

            switch(type) {
                case 'signup':
                    content = `
                        <div class="guide-section">
                            <h3>üìã Signup Guide</h3>
                            <div style="text-align: left; line-height: 1.6; margin: 20px 0;">
                                <p><strong>Before You Start:</strong></p>
                                <ul style="margin: 10px 0; padding-left: 20px;">
                                    <li>Driving licence (photo)</li>
                                    <li>Vehicle registration details</li>
                                    <li>Insurance policy number</li>
                                    <li>Vehicle photos ready</li>
                                </ul>

                                <p style="margin-top: 20px;"><strong>Steps:</strong></p>
                                <ol style="margin: 10px 0; padding-left: 20px;">
                                    <li><strong>Page 1:</strong> Create account with email & password</li>
                                    <li><strong>Pages 2-3:</strong> Personal information & contact details</li>
                                    <li><strong>Pages 4-5:</strong> Vehicle details & upload photos</li>
                                    <li><strong>Pages 6-7:</strong> Insurance information</li>
                                    <li><strong>Pages 8-9:</strong> Policyholder details (if different)</li>
                                </ol>

                                <p style="margin-top: 20px;"><strong>üí° Tips:</strong></p>
                                <ul style="margin: 10px 0; padding-left: 20px;">
                                    <li>Upload photos immediately - they save automatically</li>
                                    <li>You can save and return later</li>
                                    <li>Takes 15-30 minutes to complete</li>
                                </ul>
                            </div>

                            <button class="secondary-btn" data-action="start-signup" style="width: 100%; margin-bottom: 15px;">
                                ‚ú® Start Signup
                            </button>

                            <button class="cancel-btn" data-action="back-to-menu">
                                ‚Üê Back to Menu
                            </button>
                        </div>
                    `;
                    break;

                case 'incident':
                    content = `
                        <div class="guide-section">
                            <h3>üìù Incident Report Guide</h3>
                            <div style="text-align: left; line-height: 1.6; margin: 20px 0;">
                                <p><strong>What You'll Document:</strong></p>
                                <ul style="margin: 10px 0; padding-left: 20px;">
                                    <li>Date, time, and location of accident</li>
                                    <li>What happened (your account)</li>
                                    <li>Vehicle damage photos</li>
                                    <li>Injuries and medical details</li>
                                    <li>Other vehicles and witnesses</li>
                                    <li>Police and emergency services</li>
                                    <li>Scene photos and conditions</li>
                                </ul>

                                <p style="margin-top: 20px;"><strong>üé§ AI Features:</strong></p>
                                <ul style="margin: 10px 0; padding-left: 20px;">
                                    <li>Voice transcription - speak instead of type</li>
                                    <li>AI analysis of your case</li>
                                    <li>Automatic legal recommendations</li>
                                </ul>

                                <p style="margin-top: 20px;"><strong>üìÑ Final Report:</strong></p>
                                <ul style="margin: 10px 0; padding-left: 20px;">
                                    <li>17-page professional PDF</li>
                                    <li>All photos embedded</li>
                                    <li>Ready for insurance/solicitor</li>
                                    <li>Generated in 5 minutes</li>
                                </ul>
                            </div>

                            <button class="secondary-btn" data-action="start-incident" style="width: 100%; margin-bottom: 15px;">
                                üìù Start Incident Report
                            </button>

                            <button class="cancel-btn" data-action="back-to-menu">
                                ‚Üê Back to Menu
                            </button>
                        </div>
                    `;
                    break;

                case 'scenarios':
                    content = `
                        <div class="guide-section">
                            <h3>üé≠ Real Incident Examples</h3>
                            <p style="margin: 10px 0; font-size: 0.95em; color: #666;">These are examples of how real people describe accidents. Your account should be detailed and in your own words.</p>
                            <div style="text-align: left; line-height: 1.6; margin: 20px 0; max-height: 400px; overflow-y: auto;">

                                <div style="margin-bottom: 20px; padding: 15px; background: #f5f5f5; border-radius: 8px;">
                                    <h4 style="margin: 0 0 10px 0;">üö¶ Roundabout Collision - Watford</h4>
                                    <p style="margin: 5px 0; font-size: 0.9em; line-height: 1.5; font-style: italic;">"This morning, about half seven, I was approaching the roundabout at the junction of London Road and Station Road in Watford. It was pouring with rain, visibility wasn't great. I was indicating right to take the third exit. As I entered the roundabout, a white van came flying round from my right, didn't give way at all, just went straight into my driver's side. Absolutely smashed my door in, wing mirror's gone, front wheel arch is completely crumpled. The van driver was really aggressive, shouting that I should have given way to him, but I had right of way! I was already on the roundabout. There was a woman at the bus stop who saw everything, she gave me her number. The van's got damage to the passenger side, front wing and bumper. I called the police because he was being quite threatening. They came out, took statements from both of us and the witness. My door won't open properly now, had to get in from the passenger side. I'm okay physically, just a bit shaken up. The van's a white Ford Transit, plastering company logo on the side."</p>
                                    <p style="margin: 10px 0 0 0; font-size: 0.85em; color: #0E7490;"><strong>‚úì Good example:</strong> Specific location, time, weather, what happened, witness details, damage description, police involvement.</p>
                                </div>

                                <div style="margin-bottom: 20px; padding: 15px; background: #f5f5f5; border-radius: 8px;">
                                    <h4 style="margin: 0 0 10px 0;">üöó Rear-End Collision - M25</h4>
                                    <p style="margin: 5px 0; font-size: 0.9em; line-height: 1.5; font-style: italic;">"I was in the middle lane of the M25 anticlockwise near junction 23, doing about 50mph because the traffic was heavy. The brake lights ahead came on suddenly and everyone started slowing. I braked smoothly and came to a complete stop. Maybe two seconds later, BANG! Massive impact from behind. My head snapped back, hit the headrest. The other driver, middle-aged bloke in a BMW, said he was looking at his satnav and didn't see the traffic had stopped. My boot's completely caved in, rear bumper hanging off, back window cracked. I've got pain in my neck and shoulders, feels like whiplash. The Highways Agency came and moved us to the hard shoulder. There were loads of cars around but I didn't get witness details - too shaken up. I went to A&E after, they gave me a collar and painkillers. His car had front-end damage, radiator leaking."</p>
                                    <p style="margin: 10px 0 0 0; font-size: 0.85em; color: #0E7490;"><strong>‚úì Good example:</strong> Speed, traffic conditions, injury description, medical attention sought, admission from other driver.</p>
                                </div>

                                <div style="margin-bottom: 20px; padding: 15px; background: #f5f5f5; border-radius: 8px;">
                                    <h4 style="margin: 0 0 10px 0;">üõ£Ô∏è Lane Change - A40 London</h4>
                                    <p style="margin: 5px 0; font-size: 0.9em; line-height: 1.5; font-style: italic;">"Yesterday afternoon around 2:30, I was on the A40 Western Avenue heading into London, middle lane, doing about 40mph. Roads were wet from earlier rain but visibility was clear. This silver Ford Focus in the right lane suddenly swerved into my lane without any indication at all. I slammed on the brakes and hit my horn but they kept coming, clipped my front right wing. Made me veer left but I kept control. We both pulled onto the hard shoulder near Hanger Lane. The driver admitted she hadn't checked her blind spot properly. My front wing's scratched and dented, headlight cracked. Her rear left panel's got a big scrape and her rear light's smashed. No injuries thankfully. Got her details, insurance, took photos of both cars and the road markings. Should've got dashcam footage but my camera wasn't recording - need to sort that out."</p>
                                    <p style="margin: 10px 0 0 0; font-size: 0.85em; color: #0E7490;"><strong>‚úì Good example:</strong> Exact location, weather conditions, defensive action taken, admission from other driver, photos taken.</p>
                                </div>

                                <div style="margin-bottom: 20px; padding: 15px; background: #f5f5f5; border-radius: 8px;">
                                    <h4 style="margin: 0 0 10px 0;">üÖøÔ∏è Supermarket Car Park - Tesco</h4>
                                    <p style="margin: 5px 0; font-size: 0.9em; line-height: 1.5; font-style: italic;">"I was reversing out of a space at Tesco Extra in Watford, Saturday lunchtime so it was absolutely rammed. I'd checked my mirrors, started reversing slowly with my reverse sensors beeping. Suddenly there's this massive crunch - another car reversed into me at the same time from the opposite side. We both stopped immediately. The other driver, elderly gentleman, very apologetic, said he didn't see me. My rear passenger door's got a massive dent, wheel arch's pushed in. His front passenger wing's crumpled. A lady who was loading her shopping saw the whole thing, said we both reversed at exactly the same time. She gave me her number. I got photos of both cars, the parking spaces, and the Tesco car park CCTV cameras - there's one right above where it happened. No injuries but my daughter's car seat's in that door area and I can't fit it in now. Had to leave the car there and get a taxi home."</p>
                                    <p style="margin: 10px 0 0 0; font-size: 0.85em; color: #0E7490;"><strong>‚úì Good example:</strong> Busy conditions noted, CCTV location documented, independent witness, impact on daily life mentioned.</p>
                                </div>

                                <div style="padding: 15px; background: #fff3cd; border-radius: 8px;">
                                    <p style="margin: 0 0 10px 0; font-size: 0.9em;"><strong>‚ö†Ô∏è Important Tips:</strong></p>
                                    <ul style="margin: 0; padding-left: 20px; font-size: 0.85em;">
                                        <li>Be specific about time, location, weather</li>
                                        <li>Describe what you did to avoid the accident</li>
                                        <li>Note any admissions from the other driver</li>
                                        <li>Get witness details immediately if possible</li>
                                        <li>Note CCTV camera locations</li>
                                        <li>Mention any injuries, even if minor</li>
                                        <li>Never admit fault - just describe what happened</li>
                                    </ul>
                                </div>
                            </div>

                            <button class="cancel-btn" data-action="back-to-menu" style="margin-top: 15px;">
                                ‚Üê Back to Menu
                            </button>
                        </div>
                    `;
                    break;
            }

            guideContent.innerHTML = content;
        }

        function closeGuideModal() {
            const userGuideModal = document.getElementById('userGuideModal');
            userGuideModal.classList.remove('show');
        }

        // Add event listeners when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöó Car Crash Lawyer AI - Landing Page Initialized');

            // Main navigation buttons
            const incidentBtn = document.getElementById('incidentBtn');
            const dashboardBtn = document.getElementById('dashboardBtn');
            const demoBtn = document.getElementById('demoBtn');
            const logoutBtn = document.getElementById('logoutBtn');
            const signupBtn = document.getElementById('signupBtn');
            const userGuideBtn = document.getElementById('userGuideBtn');
            const userGuideModal = document.getElementById('userGuideModal');
            const guideContent = document.getElementById('guideContent');

            if (incidentBtn) {
                incidentBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    navigateToIncident();
                });
                console.log('‚úÖ Incident button event listener added');
            }

            if (dashboardBtn) {
                dashboardBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    navigateToDashboard();
                });
                console.log('‚úÖ Dashboard button event listener added');
            }

            if (demoBtn) {
                demoBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('üé¨ Demo button clicked');
                    window.location.href = '/demo.html';
                });
                console.log('‚úÖ Demo button event listener added');
            }

            if (logoutBtn) {
                logoutBtn.addEventListener('click', async function(e) {
                    e.preventDefault();
                    console.log('üö™ Logout button clicked');

                    try {
                        const response = await fetch('/api/auth/logout', {
                            method: 'POST',
                            credentials: 'include'
                        });

                        if (response.ok) {
                            console.log('‚úÖ Logout successful');
                            // Hide logout button, show signup button
                            logoutBtn.style.display = 'none';
                            if (signupBtn) signupBtn.style.display = 'inline-block';
                            // Redirect to landing page
                            window.location.href = '/index.html';
                        } else {
                            console.error('‚ùå Logout failed');
                        }
                    } catch (error) {
                        console.error('‚ùå Logout error:', error);
                    }
                });
                console.log('‚úÖ Logout button event listener added');
            }

            if (signupBtn) {
                signupBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('‚ú® Signup button clicked');
                    window.location.href = '/signup-form.html';
                });
                console.log('‚úÖ Signup button event listener added');
            }

            if (userGuideBtn) {
                userGuideBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('üìñ User Guide button clicked');
                    userGuideModal.classList.add('show');
                    // Reset to main menu when opening
                    showGuideMenu();
                });
                console.log('‚úÖ User Guide button event listener added');
            }

            // Check session status and show/hide logout button
            async function checkSession() {
                console.log('üîç Starting session check...');
                console.log('üîç Logout button element:', logoutBtn);
                console.log('üîç Signup button element:', signupBtn);

                try {
                    const response = await fetch('/api/auth/session', {
                        method: 'GET',
                        credentials: 'include'
                    });

                    console.log('üîç Session API response status:', response.status);

                    if (response.ok) {
                        const data = await response.json();
                        console.log('üîç Session API response data:', data);

                        if (data.authenticated && data.user) {
                            // User is logged in - show logout button, hide signup
                            console.log('‚úÖ User authenticated:', data.user.email);
                            console.log('üîç Setting logout button to display: inline-block');
                            if (logoutBtn) {
                                logoutBtn.style.display = 'inline-block';
                                console.log('üîç Logout button display after setting:', logoutBtn.style.display);
                                console.log('üîç Logout button computed style:', window.getComputedStyle(logoutBtn).display);
                            }
                            if (signupBtn) {
                                signupBtn.style.display = 'none';
                                console.log('üîç Signup button display after setting:', signupBtn.style.display);
                            }
                        } else {
                            // User not logged in - hide logout button, show signup
                            console.log('‚ÑπÔ∏è User not authenticated - data.authenticated:', data.authenticated);
                            if (logoutBtn) {
                                logoutBtn.style.display = 'none';
                            }
                            if (signupBtn) {
                                signupBtn.style.display = 'inline-block';
                            }
                        }
                    } else {
                        // Error checking session - assume not logged in
                        console.log('‚ÑπÔ∏è Session check failed with status:', response.status);
                        if (logoutBtn) {
                            logoutBtn.style.display = 'none';
                        }
                        if (signupBtn) {
                            signupBtn.style.display = 'inline-block';
                        }
                    }
                } catch (error) {
                    console.error('‚ùå Session check error:', error);
                    // On error, hide logout button, show signup
                    if (logoutBtn) {
                        logoutBtn.style.display = 'none';
                    }
                    if (signupBtn) {
                        signupBtn.style.display = 'inline-block';
                    }
                }
            }

            // Run session check on page load
            console.log('üîç About to run checkSession on page load...');
            checkSession();

            // User Guide Modal Event Delegation
            if (userGuideModal) {
                // Close modal when clicking outside
                userGuideModal.addEventListener('click', function(e) {
                    if (e.target === userGuideModal) {
                        closeGuideModal();
                    }
                });

                // Handle button clicks inside modal
                userGuideModal.addEventListener('click', function(e) {
                    const button = e.target.closest('[data-guide], [data-action]');
                    if (!button) return;

                    // Handle guide selection buttons
                    if (button.hasAttribute('data-guide')) {
                        const guideType = button.getAttribute('data-guide');
                        console.log('üìñ Guide selected:', guideType);
                        showGuideContent(guideType);
                    }

                    // Handle action buttons
                    if (button.hasAttribute('data-action')) {
                        const action = button.getAttribute('data-action');

                        switch(action) {
                            case 'cancel-guide':
                                closeGuideModal();
                                break;
                            case 'back-to-menu':
                                showGuideMenu();
                                break;
                            case 'start-signup':
                                console.log('üìù Navigating to signup form...');
                                window.location.href = '/signup-form.html';
                                break;
                            case 'start-incident':
                                console.log('üìù Navigating to incident report...');
                                window.location.href = '/incident.html';
                                break;
                        }
                    }
                });

                console.log('‚úÖ User Guide modal event listeners added');
            }

            console.log('‚úÖ Page fully loaded');
            
            // Debug: Check if buttons are clickable
            setTimeout(() => {
                console.log('üîç Checking if buttons are clickable...');
                const allButtons = document.querySelectorAll('button, .auth-btn, .secondary-btn');
                console.log(`‚úÖ Found ${allButtons.length} total buttons`);
                
                allButtons.forEach((btn, index) => {
                    const text = btn.textContent.trim();
                    const hasClick = btn.onclick || btn.getAttribute('onclick') || btn.hasAttribute('onclick');
                    console.log(`[${index}] "${text}" - Has click handler: ${!!hasClick}`);
                });
                
                console.log('‚úÖ All buttons found and ready');
            }, 100);

            // Fallback click handlers (in case inline onclick doesn't work)
            document.body.addEventListener('click', function(e) {
                const target = e.target;
                const text = target.textContent.trim();

                if (target.matches('.secondary-btn')) {
                    if (text.includes('Report an Incident')) {
                        e.preventDefault();
                        navigateToIncident();
                    } else if (text.includes('View My Reports')) {
                        e.preventDefault();
                        navigateToDashboard();
                    } else if (text.includes('Try Demo')) {
                        e.preventDefault();
                        window.location.href = '/demo.html';
                    } else if (text.includes('User Guide')) {
                        e.preventDefault();
                        if (userGuideModal) {
                            userGuideModal.classList.add('show');
                            showGuideMenu();
                        }
                    }
                } else if (target.matches('.auth-btn.logout')) {
                    e.preventDefault();
                    // Logout handler already attached above, this is just fallback
                    if (logoutBtn) logoutBtn.click();
                } else if (target.matches('.auth-btn.signup')) {
                    e.preventDefault();
                    window.location.href = '/signup-form.html';
                }
            });
            
            console.log('‚úÖ Fallback event listeners added');
        });

        // ==================== CORS ERROR DETECTION ====================

        /**
         * Global fetch interceptor for CORS debugging and user-friendly error handling
         * Wraps native fetch to detect and handle CORS errors gracefully
         */
        (function() {
            const originalFetch = window.fetch;

            window.fetch = function(...args) {
                const url = typeof args[0] === 'string' ? args[0] : args[0].url;

                return originalFetch.apply(this, args)
                    .then(response => {
                        // Log successful CORS responses in development
                        if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                            console.debug('[CORS] Success:', url, response.status);
                        }
                        return response;
                    })
                    .catch(error => {
                        // Detect CORS-related errors
                        const isCorsError =
                            error.message.toLowerCase().includes('cors') ||
                            error.message.toLowerCase().includes('cross-origin') ||
                            (error.name === 'TypeError' && error.message.includes('fetch'));

                        if (isCorsError) {
                            console.error('[CORS ERROR] Request blocked:', {
                                url: url,
                                origin: window.location.origin,
                                error: error.message,
                                timestamp: new Date().toISOString()
                            });

                            // Show user-friendly error (only in development)
                            if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                                console.warn(
                                    '%c‚ö†Ô∏è CORS ERROR DETECTED',
                                    'color: red; font-size: 16px; font-weight: bold',
                                    '\nURL:', url,
                                    '\nOrigin:', window.location.origin,
                                    '\nCheck console for details or contact support.'
                                );
                            } else {
                                // Production: Silent logging, generic error
                                console.error('Connection error. Please try again or contact support.');
                            }
                        }

                        // Re-throw the error for original error handlers
                        throw error;
                    });
            };

            console.info('[CORS Monitor] Initialized - Fetch requests will be monitored for CORS issues');
        })();
    </script>
    <script src="/js/mascot.js"></script></body>
</html>