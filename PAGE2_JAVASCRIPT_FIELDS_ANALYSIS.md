# Page 2 JavaScript Field Analysis

**File:** `public/incident-form-page2.html`
**Page:** Medical Information (Page 2 of 12)

## JavaScript-Generated Fields

### 1. Timestamp Field (Generated)

| Field Name | Type | Generated By | Value |
|------------|------|--------------|-------|
| `completed_at` | TIMESTAMP | JavaScript | `new Date().toISOString()` |

**Location in Code:** Line 881
```javascript
completed_at: new Date().toISOString()
```

**Purpose:** Records when the page was completed
**Stored:** sessionStorage as `incident_page2`
**Not in HTML:** This field does NOT exist in the HTML - it's purely JavaScript-generated

---

## Fields Controlled by JavaScript

While these fields exist in HTML, their behavior is controlled by JavaScript:

### 2. Conditional Visibility (Dynamic Show/Hide)

JavaScript controls which fields are visible based on user selections:

#### Group A: Medical Details (Shown when `medical_attention_needed` = "yes")

| Field Name | HTML Type | Controlled By JS | Default State |
|------------|-----------|------------------|---------------|
| `medical_injury_details` | textarea | Yes | Hidden |
| `medical_injury_severity` | select | Yes | Hidden |
| `medical_hospital_name` | input text | Yes | Hidden |
| `medical_ambulance_called` | radio | Yes | Hidden |
| `medical_treatment_received` | textarea | Yes | Hidden |

**JavaScript Function:** `updateMedicalFields()` (lines 768-789)
**Trigger:** Change event on `medical_attention_needed` radio buttons

**Behavior:**
```javascript
if (selectedValue === 'yes') {
  medicalDetailsGroup.style.display = 'block';
  // Make conditional fields required
  document.getElementById('medical_injury_details').required = true;
  document.getElementById('medical_injury_severity').required = true;
}
```

#### Group B: Treatment Details (Shown when `medical_ambulance_called` = "yes")

| Field Name | HTML Type | Controlled By JS | Default State |
|------------|-----------|------------------|---------------|
| `medical_treatment_received` | textarea | Yes | Hidden |

**JavaScript Function:** `updateTreatmentField()` (lines 799-807)
**Trigger:** Change event on `medical_ambulance_called` radio buttons

**Behavior:**
```javascript
if (ambulanceYes && ambulanceYes.checked) {
  treatmentGroup.style.display = 'block';
}
```

---

## Complete Field List (Page 2)

### Static HTML Fields (Not Generated by JS)

#### 1. Medical Attention (Radio Group)
- `medical_attention_needed` (radio: yes/no) - **Required**

#### 2. Conditional Fields (Medical Details)
- `medical_injury_details` (textarea) - **Conditionally Required**
- `medical_injury_severity` (select) - **Conditionally Required**
- `medical_hospital_name` (text input) - Optional
- `medical_ambulance_called` (radio: yes/no) - **Conditionally Required**
- `medical_treatment_received` (textarea) - **Conditionally Visible**

#### 3. Medical Symptoms (Checkboxes - Always Visible)
- `medical_symptom_chest_pain` (checkbox)
- `medical_symptom_uncontrolled_bleeding` (checkbox)
- `medical_symptom_breathlessness` (checkbox)
- `medical_symptom_limb_weakness` (checkbox)
- `medical_symptom_dizziness` (checkbox)
- `medical_symptom_loss_of_consciousness` (checkbox)
- `medical_symptom_severe_headache` (checkbox)
- `medical_symptom_change_in_vision` (checkbox)
- `medical_symptom_abdominal_pain` (checkbox)
- `medical_symptom_abdominal_bruising` (checkbox)
- `medical_symptom_limb_pain_mobility` (checkbox)
- `medical_symptom_life_threatening` (checkbox)
- `medical_symptom_none` (checkbox)

---

## JavaScript Data Collection Process

### On Form Submission (nextBtn click)

**Code Location:** Lines 850-890

```javascript
// Collect symptoms (checkboxes)
const symptoms = {
  medical_symptom_chest_pain: document.getElementById('symptom_chest_pain').checked,
  medical_symptom_uncontrolled_bleeding: document.getElementById('symptom_uncontrolled_bleeding').checked,
  // ... 11 more symptom checkboxes
};

// Build page data
const pageData = {
  medical_attention_needed: document.querySelector('input[name="medical_attention_needed"]:checked')?.value,
  medical_injury_details: document.getElementById('medical_injury_details').value.trim(),
  medical_injury_severity: document.getElementById('medical_injury_severity').value,
  medical_hospital_name: document.getElementById('medical_hospital_name').value.trim(),
  medical_ambulance_called: document.querySelector('input[name="medical_ambulance_called"]:checked')?.value,
  medical_treatment_received: document.getElementById('medical_treatment_received').value.trim(),
  ...symptoms,
  completed_at: new Date().toISOString() // ‚≠ê GENERATED FIELD
};

sessionStorage.setItem('incident_page2', JSON.stringify(pageData));
```

### On Page Load (Data Restoration)

**Code Location:** Lines 898-946

JavaScript restores all field values from sessionStorage if user navigates back to the page.

---

## Summary

### Fields Generated by JavaScript: **1**
- `completed_at` (timestamp)

### Fields Controlled by JavaScript: **5**
- `medical_injury_details` (conditionally visible/required)
- `medical_injury_severity` (conditionally visible/required)
- `medical_hospital_name` (conditionally visible)
- `medical_ambulance_called` (conditionally visible/required)
- `medical_treatment_received` (conditionally visible)

### Static HTML Fields: **14**
- 1 primary radio group (medical_attention_needed)
- 13 symptom checkboxes

### Total Fields on Page: **20**
- 19 HTML fields
- 1 JavaScript-generated field

---

## Key JavaScript Behaviors

### 1. Dynamic Required Validation
Fields become required/optional based on user selections:
```javascript
document.getElementById('medical_injury_details').required = true; // When medical attention = yes
document.getElementById('medical_injury_details').required = false; // When medical attention = no
```

### 2. Conditional Field Clearing
When user selects "No" for medical attention, all conditional fields are cleared:
```javascript
document.getElementById('medical_injury_details').value = '';
document.getElementById('medical_injury_severity').value = '';
document.getElementById('medical_hospital_name').value = '';
// ... etc
```

### 3. Real-time Validation
Form validation happens on "Continue" button click (lines 814-847)

### 4. SessionStorage Persistence
All data is saved to sessionStorage for multi-page form flow:
- **Save:** `sessionStorage.setItem('incident_page2', JSON.stringify(pageData))`
- **Load:** `sessionStorage.getItem('incident_page2')`

---

**Generated:** 2025-11-05
**Source:** Claude Code Analysis
